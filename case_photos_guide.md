# æ¡ˆä¾‹ç…§ç‰‡ä½¿ç”¨æŒ‡å—

## ğŸ“¸ ç…§ç‰‡å‡†å¤‡

### 1. åˆ›å»ºç…§ç‰‡ç›®å½•

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `case_photos` æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ¡ˆä¾‹ç…§ç‰‡ï¼š

```
Restore/
  â”œâ”€â”€ case_photos/
  â”‚   â”œâ”€â”€ dunhuang_before.jpg
  â”‚   â”œâ”€â”€ dunhuang_after.jpg
  â”‚   â”œâ”€â”€ yungang_before.jpg
  â”‚   â”œâ”€â”€ longmen_before.jpg
  â”‚   â””â”€â”€ maijishan_before.jpg
  â””â”€â”€ ...
```

### 2. ç…§ç‰‡å‘½åè§„èŒƒ

å»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½åæ ¼å¼ï¼š
- `{çŸ³çªŸå}_{çŠ¶æ€}.jpg` - ä¾‹å¦‚ï¼š`dunhuang_before.jpg`
- `{çŸ³çªŸå}_{ç—…å®³ç±»å‹}.jpg` - ä¾‹å¦‚ï¼š`yungang_peeling.jpg`
- `{æ¡ˆä¾‹ID}_{ç±»å‹}_{åºå·}.jpg` - ä¾‹å¦‚ï¼š`case1_before_1.jpg`

**çŠ¶æ€æ ‡è¯†ï¼š**
- `before` - ä¿®å¤å‰
- `after` - ä¿®å¤å
- `process` - ä¿®å¤è¿‡ç¨‹

### 3. ç…§ç‰‡è¦æ±‚

- **æ ¼å¼**ï¼šJPGã€JPEGã€PNG
- **å°ºå¯¸**ï¼šå»ºè®®ä¸è¶…è¿‡ 1920x1920 åƒç´ ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨å‹ç¼©ï¼‰
- **å¤§å°**ï¼šå»ºè®®æ¯å¼ ä¸è¶…è¿‡ 5MB
- **è´¨é‡**ï¼šæ¸…æ™°å¯è§ï¼Œèƒ½å±•ç¤ºç—…å®³ç»†èŠ‚

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: é€šè¿‡å¯¼å…¥è„šæœ¬è‡ªåŠ¨å¤„ç†

```python
# 1. å°†ç…§ç‰‡æ”¾å…¥ case_photos ç›®å½•
# 2. è¿è¡Œå¯¼å…¥è„šæœ¬
python import_case_examples.py
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æŸ¥æ‰¾å¯¹åº”ç…§ç‰‡
- è½¬æ¢ä¸ºBase64ç¼–ç 
- å‹ç¼©åˆ°åˆé€‚å°ºå¯¸
- å¯¼å…¥åˆ°æ¡ˆä¾‹åº“

### æ–¹æ³•2: æ‰‹åŠ¨å¤„ç†ç…§ç‰‡

```python
from photo_processor import image_to_base64
from knowledge_base import CaseLibrary

# è½¬æ¢ç…§ç‰‡ä¸ºBase64
base64_data = image_to_base64(
    "case_photos/dunhuang_before.jpg",
    max_size=(1920, 1920),  # æœ€å¤§å°ºå¯¸
    quality=85  # JPEGè´¨é‡
)

# æ·»åŠ åˆ°æ¡ˆä¾‹
case_lib = CaseLibrary()
case_id = case_lib.add_case(
    title="æ¡ˆä¾‹æ ‡é¢˜",
    # ... å…¶ä»–å­—æ®µ
    before_images_base64=[base64_data]
)
```

### æ–¹æ³•3: æ‰¹é‡å¤„ç†ç›®å½•

```python
from photo_processor import process_case_photos

# æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰ç…§ç‰‡
photos = process_case_photos("case_photos", max_size=(1920, 1920))

# photos æ˜¯ä¸€ä¸ªå­—å…¸ï¼š{æ–‡ä»¶å: Base64ç¼–ç }
for key, base64_data in photos.items():
    print(f"{key}: {len(base64_data)} å­—ç¬¦")
```

### æ–¹æ³•4: é€šè¿‡å‰ç«¯ç•Œé¢ä¸Šä¼ 

1. å¯åŠ¨åº”ç”¨ï¼š`python start_app.py`
2. è®¿é—®ï¼š`http://localhost:8501`
3. è¿›å…¥"æ¡ˆä¾‹åº“"æ ‡ç­¾é¡µ
4. ç‚¹å‡»"æ·»åŠ æ¡ˆä¾‹"
5. ä¸Šä¼ ç…§ç‰‡æ–‡ä»¶ï¼ˆæ”¯æŒå¤šæ–‡ä»¶ï¼‰

## ğŸ“‹ ç…§ç‰‡å¤„ç†å·¥å…·åŠŸèƒ½

### `image_to_base64(image_path, max_size, quality)`
å°†å›¾ç‰‡æ–‡ä»¶è½¬æ¢ä¸ºBase64ç¼–ç 

**å‚æ•°ï¼š**
- `image_path`: å›¾ç‰‡è·¯å¾„
- `max_size`: æœ€å¤§å°ºå¯¸å…ƒç»„ï¼Œå¦‚ `(1920, 1920)`
- `quality`: JPEGè´¨é‡ (1-100)

**è¿”å›ï¼š**
- Base64ç¼–ç å­—ç¬¦ä¸²ï¼ˆåŒ…å«data URIå‰ç¼€ï¼‰

### `base64_to_image(base64_string)`
å°†Base64ç¼–ç è½¬æ¢ä¸ºPIL Imageå¯¹è±¡

### `process_case_photos(photo_dir, max_size)`
æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰å›¾ç‰‡

### `save_base64_to_file(base64_string, output_path)`
å°†Base64ç¼–ç ä¿å­˜ä¸ºå›¾ç‰‡æ–‡ä»¶

### `get_image_info(image_path)`
è·å–å›¾ç‰‡ä¿¡æ¯ï¼ˆå°ºå¯¸ã€æ ¼å¼ã€å¤§å°ç­‰ï¼‰

## ğŸ¯ åœ¨Streamlitä¸­æ˜¾ç¤ºç…§ç‰‡

æ¡ˆä¾‹åº“ç•Œé¢ä¼šè‡ªåŠ¨æ˜¾ç¤ºç…§ç‰‡ï¼š

1. **ä¿®å¤å‰å›¾ç‰‡**ï¼šæ˜¾ç¤ºåœ¨æ¡ˆä¾‹è¯¦æƒ…ä¸­
2. **ä¿®å¤åå›¾ç‰‡**ï¼šæ˜¾ç¤ºåœ¨æ¡ˆä¾‹è¯¦æƒ…ä¸­
3. **ä¿®å¤è¿‡ç¨‹å›¾ç‰‡**ï¼šæ˜¾ç¤ºåœ¨æ¡ˆä¾‹è¯¦æƒ…ä¸­

ç…§ç‰‡ä»¥3åˆ—ç½‘æ ¼å¸ƒå±€æ˜¾ç¤ºï¼Œæœ€å¤šæ˜¾ç¤º3å¼ ã€‚

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç…§ç‰‡ç»„ç»‡**
   - æŒ‰çŸ³çªŸåˆ†ç±»å­˜æ”¾
   - ä½¿ç”¨æ¸…æ™°çš„å‘½å
   - ä¿æŒç…§ç‰‡è´¨é‡

2. **ç…§ç‰‡é€‰æ‹©**
   - é€‰æ‹©èƒ½æ¸…æ™°å±•ç¤ºç—…å®³çš„ç…§ç‰‡
   - å‰åå¯¹æ¯”ç…§ç‰‡è§’åº¦å°½é‡ä¸€è‡´
   - åŒ…å«å…³é”®ç»†èŠ‚çš„ç‰¹å†™

3. **æ•°æ®ç®¡ç†**
   - å®šæœŸå¤‡ä»½ç…§ç‰‡ç›®å½•
   - å»ºç«‹ç…§ç‰‡ç´¢å¼•æ–‡æ¡£
   - è®°å½•ç…§ç‰‡æ¥æºå’Œæ‹æ‘„ä¿¡æ¯

4. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨é€‚å½“çš„å‹ç¼©æ¯”ä¾‹
   - æ§åˆ¶ç…§ç‰‡æ•°é‡ï¼ˆæ¯ç±»ä¸è¶…è¿‡3å¼ ï¼‰
   - å®šæœŸæ¸…ç†ä¸éœ€è¦çš„ç…§ç‰‡

## ğŸ” ç…§ç‰‡æ£€ç´¢

ç…§ç‰‡ä¼šä¸æ¡ˆä¾‹ä¸€èµ·å­˜å‚¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€ç´¢ï¼š

```python
from knowledge_base import CaseLibrary

case_lib = CaseLibrary()
case = case_lib.get_case(case_id)

# è·å–ç…§ç‰‡è·¯å¾„åˆ—è¡¨
before_images = case.get('before_images', [])
after_images = case.get('after_images', [])

# è½¬æ¢ä¸ºBase64æ˜¾ç¤º
from knowledge_base import CaseLibrary
case_lib = CaseLibrary()
for img_path in before_images:
    base64_data = case_lib.get_case_image_base64(img_path)
    # åœ¨Streamlitä¸­æ˜¾ç¤º
    # st.image(base64_data)
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **éšç§ä¿æŠ¤**ï¼šæ•æ„Ÿç…§ç‰‡æ³¨æ„è®¿é—®æƒé™
2. **ç‰ˆæƒé—®é¢˜**ï¼šç¡®ä¿ç…§ç‰‡ä½¿ç”¨æƒé™
3. **å­˜å‚¨ç©ºé—´**ï¼šå¤§é‡ç…§ç‰‡ä¼šå ç”¨å­˜å‚¨ç©ºé—´
4. **åŠ è½½é€Ÿåº¦**ï¼šBase64ç¼–ç ä¼šå¢åŠ æ•°æ®å¤§å°

ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°å°†çœŸå®ç…§ç‰‡æ·»åŠ åˆ°æ¡ˆä¾‹åº“ä¸­äº†ï¼

