# æ¡ˆä¾‹åº“ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æ¡ˆä¾‹åº“ç³»ç»Ÿæ”¯æŒï¼š
- âœ… çœŸå®ç…§ç‰‡å­˜å‚¨å’Œæ˜¾ç¤ºï¼ˆæ”¯æŒBase64ç¼–ç ï¼‰
- âœ… å‰åå¯¹æ¯”ç…§ç‰‡å±•ç¤º
- âœ… ä¿®å¤è¿‡ç¨‹è®°å½•
- âœ… å¤šç»´åº¦æœç´¢å’Œç­›é€‰
- âœ… é€šè¿‡APIæ‰¹é‡å¯¼å…¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥ç¤ºä¾‹æ¡ˆä¾‹

```bash
python import_case_examples.py
```

è¿™ä¼šå¯¼å…¥4ä¸ªç¤ºä¾‹æ¡ˆä¾‹ï¼š
- æ•¦ç…Œè«é«˜çªŸç¬¬45çªŸä¿®å¤æ¡ˆä¾‹
- äº‘å†ˆçŸ³çªŸç¬¬20çªŸä¿æŠ¤æ¡ˆä¾‹
- é¾™é—¨çŸ³çªŸç”Ÿç‰©ç—…å®³æ²»ç†æ¡ˆä¾‹
- éº¦ç§¯å±±çŸ³çªŸç»“æ„ç¨³å®šæ€§ä¿æŠ¤æ¡ˆä¾‹

### 2. æ·»åŠ ç…§ç‰‡

#### æ–¹å¼1: å‡†å¤‡ç…§ç‰‡ç›®å½•

åˆ›å»º `case_photos` ç›®å½•ï¼Œæ”¾å…¥ç…§ç‰‡ï¼š
```
case_photos/
  â”œâ”€â”€ dunhuang_before.jpg
  â”œâ”€â”€ dunhuang_after.jpg
  â”œâ”€â”€ yungang_before.jpg
  â””â”€â”€ ...
```

ç„¶åè¿è¡Œå¯¼å…¥è„šæœ¬ï¼Œä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶å¤„ç†ç…§ç‰‡ã€‚

#### æ–¹å¼2: é€šè¿‡å‰ç«¯ä¸Šä¼ 

1. å¯åŠ¨åº”ç”¨ï¼š`python start_app.py`
2. è®¿é—®ï¼š`http://localhost:8501`
3. è¿›å…¥"æ¡ˆä¾‹åº“" â†’ "æ·»åŠ æ¡ˆä¾‹"
4. ä¸Šä¼ ç…§ç‰‡æ–‡ä»¶

#### æ–¹å¼3: é€šè¿‡APIä¸Šä¼ 

```python
import requests
from photo_processor import image_to_base64

# è½¬æ¢ç…§ç‰‡ä¸ºBase64
base64_data = image_to_base64("case_photos/dunhuang_before.jpg")

# é€šè¿‡APIæ·»åŠ 
response = requests.post(
    "http://localhost:8000/api/case/add_with_base64",
    data={
        "title": "æ¡ˆä¾‹æ ‡é¢˜",
        "description": "æ¡ˆä¾‹æè¿°",
        "before_images_base64": json.dumps([base64_data])
    }
)
```

## ğŸ“¸ ç…§ç‰‡å¤„ç†å·¥å…·

### åŸºæœ¬ä½¿ç”¨

```python
from photo_processor import image_to_base64, process_case_photos

# å•ä¸ªç…§ç‰‡è½¬æ¢
base64_data = image_to_base64(
    "photo.jpg",
    max_size=(1920, 1920),  # æœ€å¤§å°ºå¯¸
    quality=85  # JPEGè´¨é‡
)

# æ‰¹é‡å¤„ç†ç›®å½•
photos = process_case_photos("case_photos")
# è¿”å›: {"filename": "data:image/jpeg;base64,..."}
```

### ç…§ç‰‡è¦æ±‚

- **æ ¼å¼**: JPG, JPEG, PNG
- **å°ºå¯¸**: å»ºè®®ä¸è¶…è¿‡ 1920x1920ï¼ˆä¼šè‡ªåŠ¨å‹ç¼©ï¼‰
- **å¤§å°**: å»ºè®®æ¯å¼ ä¸è¶…è¿‡ 5MB
- **è´¨é‡**: æ¸…æ™°å¯è§ï¼Œèƒ½å±•ç¤ºç—…å®³ç»†èŠ‚

## ğŸ” æœç´¢æ¡ˆä¾‹

### å‰ç«¯æœç´¢

åœ¨"æ¡ˆä¾‹åº“"æ ‡ç­¾é¡µä¸­ï¼š
- æŒ‰å…³é”®è¯æœç´¢
- æŒ‰æè´¨ç±»å‹ç­›é€‰
- æŒ‰ç—…å®³ç±»å‹ç­›é€‰
- æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰

### APIæœç´¢

```python
import requests

response = requests.get(
    "http://localhost:8000/api/case/search",
    params={
        "keyword": "æ•¦ç…Œ",
        "material_type": "æ•¦ç…Œè«é«˜çªŸï¼ˆç°æ³¥/é¢œæ–™å±‚ï¼‰",
        "disease_type": "èµ·ç”²",
        "limit": 10
    }
)
```

## ğŸ“Š æ¡ˆä¾‹æ•°æ®ç»“æ„

æ¯ä¸ªæ¡ˆä¾‹åŒ…å«ï¼š

```python
{
    "id": 1,
    "title": "æ¡ˆä¾‹æ ‡é¢˜",
    "location": "ä½ç½®",
    "material_type": "æè´¨ç±»å‹",
    "era": "å¹´ä»£",
    "disease_types": ["ç—…å®³1", "ç—…å®³2"],
    "severity_level": "ä¸¥é‡ç¨‹åº¦",
    "description": "æ¡ˆä¾‹æè¿°",
    "diagnosis_result": "è¯Šæ–­ç»“æœ",
    "treatment_plan": "ä¿®å¤æ–¹æ¡ˆ",
    "treatment_result": "ä¿®å¤ç»“æœ",
    "before_images": ["å›¾ç‰‡è·¯å¾„1", "å›¾ç‰‡è·¯å¾„2"],
    "after_images": ["å›¾ç‰‡è·¯å¾„1"],
    "process_images": ["å›¾ç‰‡è·¯å¾„1"],
    "created_at": "åˆ›å»ºæ—¶é—´",
    "author": "æäº¤äºº",
    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
}
```

## ğŸ¨ å‰ç«¯æ˜¾ç¤º

æ¡ˆä¾‹åº“ç•Œé¢ä¼šè‡ªåŠ¨ï¼š
- æ˜¾ç¤ºæ¡ˆä¾‹åŸºæœ¬ä¿¡æ¯
- å±•ç¤ºä¿®å¤å‰åå¯¹æ¯”ç…§ç‰‡ï¼ˆ3åˆ—ç½‘æ ¼å¸ƒå±€ï¼‰
- å±•å¼€/æ”¶èµ·è¯Šæ–­ç»“æœã€ä¿®å¤æ–¹æ¡ˆã€ä¿®å¤ç»“æœ
- æ”¯æŒå›¾ç‰‡ç‚¹å‡»æ”¾å¤§æŸ¥çœ‹

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç…§ç‰‡ç»„ç»‡**
   - ä½¿ç”¨æ¸…æ™°çš„å‘½åï¼š`{çŸ³çªŸ}_{çŠ¶æ€}.jpg`
   - æŒ‰çŸ³çªŸåˆ†ç±»å­˜æ”¾
   - ä¿æŒç…§ç‰‡è´¨é‡

2. **æ¡ˆä¾‹æè¿°**
   - è¯¦ç»†è®°å½•é—®é¢˜æè¿°
   - è¯´æ˜è¯Šæ–­è¿‡ç¨‹å’Œç»“æœ
   - è®°å½•ä¿®å¤æ–¹æ¡ˆå’Œæ•ˆæœ

3. **æ•°æ®ç®¡ç†**
   - å®šæœŸå¤‡ä»½æ¡ˆä¾‹åº“æ•°æ®åº“
   - å»ºç«‹ç…§ç‰‡ç´¢å¼•
   - è®°å½•æ¡ˆä¾‹æ¥æº

## ğŸ“ APIæ¥å£

### æ·»åŠ æ¡ˆä¾‹ï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰
```
POST /api/case/add
Content-Type: multipart/form-data
```

### æ·»åŠ æ¡ˆä¾‹ï¼ˆBase64ï¼‰
```
POST /api/case/add_with_base64
Content-Type: multipart/form-data
```

### æœç´¢æ¡ˆä¾‹
```
GET /api/case/search?keyword=xxx&material_type=xxx
```

### è·å–æ¡ˆä¾‹è¯¦æƒ…
```
GET /api/case/{case_id}
```

### è·å–ç›¸ä¼¼æ¡ˆä¾‹
```
GET /api/case/{case_id}/similar?limit=5
```

è¯¦ç»†APIæ–‡æ¡£è¯·è®¿é—®ï¼š`http://localhost:8000/docs`

## ğŸ”§ ç…§ç‰‡å¤„ç†ç¤ºä¾‹

```python
from photo_processor import image_to_base64
from knowledge_base import CaseLibrary

# 1. è½¬æ¢ç…§ç‰‡
before_base64 = image_to_base64("before.jpg")
after_base64 = image_to_base64("after.jpg")

# 2. æ·»åŠ åˆ°æ¡ˆä¾‹
case_lib = CaseLibrary()
case_id = case_lib.add_case(
    title="ä¿®å¤æ¡ˆä¾‹",
    description="æ¡ˆä¾‹æè¿°",
    before_images_base64=[before_base64],
    after_images_base64=[after_base64]
)
```

ç°åœ¨æ‚¨çš„æ¡ˆä¾‹åº“ç³»ç»Ÿå·²ç»å®Œå…¨æ”¯æŒçœŸå®ç…§ç‰‡äº†ï¼

