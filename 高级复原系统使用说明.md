# 高级图像复原系统使用说明

## 🎨 功能概述

高级图像复原系统提供了比基础复原更强大的功能，包括：

- ✅ **智能修复算法**：根据不同病害类型自动选择最佳算法
- ✅ **纹理感知修复**：保持壁画纹理特征
- ✅ **多尺度修复**：在不同尺度上处理细节
- ✅ **高级色彩复原**：自适应对比度增强、智能白平衡、饱和度优化
- ✅ **差异化修复策略**：针对裂缝、剥落、污渍等不同病害采用专门策略
- ✅ **修复效果评估**：量化修复区域和效果
- ✅ **详细修复报告**：自动生成修复报告

## 🚀 使用方法

### 1. 启动应用

```bash
python start_app.py
```

访问：`http://localhost:8501`

### 2. 使用高级复原功能

1. **上传图像并完成诊断**
   - 进入"二维壁画诊断"标签页
   - 上传壁画图像
   - 等待系统完成病害检测

2. **启用高级复原**
   - 在诊断结果页面下方，找到"高级图像复原系统"部分
   - 点击展开高级复原选项

3. **配置修复参数**

   **修复目标选择**
   - 选择需要修复的病害类型（可多选）
   - 支持：裂缝、剥落、褪色、污渍/霉斑、盐蚀/风化、生物附着

   **修复算法**
   - **综合智能修复**：自动选择最佳算法（推荐）
   - **Telea算法**：快速修复，适合简单场景
   - **Navier-Stokes算法**：质量优先，适合复杂纹理
   - **纹理感知修复**：保持纹理特征
   - **深度学习修复**：模拟深度学习效果

   **参数配置**
   - **修复半径**：1-15像素，影响修复范围
   - **修复迭代次数**：1-5次，多次迭代可能获得更好效果
   - **启用色彩复原**：自动调整色彩、对比度和饱和度

   **高级选项**
   - **纹理权重**：0.0-1.0，控制纹理保持程度
   - **对比度增强**：1.0-3.0，色彩复原时的对比度强度
   - **饱和度增强**：1.0-2.0，色彩复原时的饱和度强度
   - **锐化强度**：0.0-1.5，图像锐化强度

4. **执行修复**
   - 点击"🚀 执行高级复原"按钮
   - 等待处理完成（可能需要几秒到几十秒）

5. **查看结果**
   - **原始图像**：显示原始壁画
   - **修复区域标识**：红色区域表示修复区域
   - **复原后图像**：显示修复后的效果
   - **修复统计**：显示修复区域占比

6. **下载结果**
   - **下载复原图像**：PNG格式
   - **下载修复报告**：TXT格式，包含详细修复信息

## 📊 修复算法说明

### 综合智能修复（推荐）

自动分析病害类型，采用差异化修复策略：

- **裂缝**：使用细线修复算法，保持连续性
- **剥落**：使用纹理合成算法，重建表面纹理
- **污渍/霉斑**：使用色彩校正算法，去除污染
- **其他病害**：使用标准修复算法

### Telea算法

- **特点**：快速、适合简单场景
- **适用**：小面积缺损、简单纹理
- **速度**：快

### Navier-Stokes算法

- **特点**：质量优先、适合复杂纹理
- **适用**：大面积缺损、复杂纹理
- **速度**：较慢

### 纹理感知修复

- **特点**：保持纹理特征
- **适用**：需要保持纹理的修复场景
- **纹理权重**：可调整纹理保持程度

### 深度学习修复（模拟）

- **特点**：多尺度融合，模拟深度学习效果
- **适用**：复杂场景
- **注意**：这是模拟实现，实际效果可能不如真实深度学习模型

## 🎯 修复策略

### 针对裂缝

- 使用细线修复算法（Navier-Stokes，半径2）
- 多次迭代（2次）确保连续性
- 保持线条的连贯性

### 针对剥落

- 使用纹理感知修复
- 高纹理权重（0.8）保持纹理特征
- 重建表面纹理

### 针对污渍/霉斑

- 使用色彩校正算法
- 去除污染色彩
- 恢复原始色彩

## 💡 使用建议

### 参数调优

1. **修复半径**
   - 小面积病害：1-3像素
   - 中等面积：3-7像素
   - 大面积：7-15像素

2. **迭代次数**
   - 简单场景：1次即可
   - 复杂场景：2-3次
   - 极复杂场景：3-5次（注意处理时间）

3. **纹理权重**
   - 需要保持纹理：0.7-0.9
   - 一般修复：0.5-0.7
   - 色彩优先：0.3-0.5

4. **色彩复原**
   - 褪色严重：启用，提高对比度和饱和度
   - 色彩正常：可禁用，保持原始色彩

### 最佳实践

1. **先诊断后修复**
   - 先完成病害检测，了解病害分布
   - 根据检测结果选择修复目标

2. **分步修复**
   - 可以先修复主要病害（如裂缝、剥落）
   - 再修复次要病害（如污渍）

3. **对比效果**
   - 尝试不同算法和参数
   - 对比修复效果，选择最佳方案

4. **保存结果**
   - 及时下载修复结果
   - 保存修复报告，记录修复参数

## ⚠️ 注意事项

1. **虚拟修复仅供参考**
   - 虚拟修复结果仅供参考
   - 实际修复需专业评估和实地勘察

2. **材料兼容性**
   - 建议结合材料分析
   - 确保修复材料兼容性

3. **遵循规范**
   - 重要文物修复应遵循相关规范和标准
   - 建议咨询文物保护专家

4. **处理时间**
   - 复杂场景可能需要较长时间
   - 建议耐心等待处理完成

## 🔧 技术细节

### 修复流程

1. **创建综合掩膜**
   - 根据选择的病害类型创建掩膜
   - 形态学操作优化掩膜

2. **选择修复策略**
   - 分析病害类型
   - 选择对应的修复算法

3. **执行修复**
   - 根据配置参数执行修复
   - 支持多次迭代

4. **色彩复原**（可选）
   - 白平衡调整
   - 对比度增强
   - 饱和度优化
   - 锐化处理

5. **结果输出**
   - 生成修复图像
   - 计算修复统计
   - 生成修复报告

### 算法原理

- **Telea算法**：基于快速行进法（Fast Marching Method）
- **Navier-Stokes算法**：基于流体动力学方程
- **纹理感知修复**：多算法融合，基于纹理相似度
- **深度学习修复**：多尺度融合，模拟深度学习效果

## 📝 修复报告

修复报告包含：

- 修复时间
- 原始图像尺寸
- 修复统计（修复区域像素、占比）
- 修复病害类型
- 修复参数（算法、半径、迭代次数等）
- 技术说明
- 注意事项

## 🆚 与基础复原的对比

| 功能 | 基础复原 | 高级复原 |
|------|---------|---------|
| 算法选择 | 2种（Telea/NS） | 5种（包括智能修复） |
| 色彩复原 | ❌ | ✅ |
| 纹理感知 | ❌ | ✅ |
| 差异化策略 | ❌ | ✅ |
| 参数调优 | 基础 | 高级 |
| 效果评估 | 基础 | 详细 |
| 修复报告 | ❌ | ✅ |

## 🎓 学习资源

- OpenCV文档：https://docs.opencv.org/
- 图像修复算法论文
- 文物保护技术规范

现在您可以享受更强大的图像复原功能了！

